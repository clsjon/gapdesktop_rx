<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas
	xmlns:s="library://ns.adobe.com/flex/spark" 
	xmlns:mx="http://www.adobe.com/2006/mxml"
	creationComplete="graphHTML_completeHandler(event)"
	height="100%"
	width="100%"
	label="{example.name}"
	>
	<mx:Metadata>
		[Event(name="exampleChanged", type="events.ExampleChangeEvent")]
	</mx:Metadata>
	<mx:Script>
		<![CDATA[
			import flash.events.Event;
			
			import gapdesktoprx.events.ExampleChangeEvent;
			import gapdesktoprx.models.Example;
			import gapdesktoprx.overrides.TlzHost;
			
			import mx.controls.Alert;
			
			import org.restfulx.utils.RxUtils;
			
			private var _htmlLoader:HTMLLoader;
			
			[Bindable]
			private var _example:Example = new Example();
			
			private function updateHash(newHash:String):void {
				//trace("Incoming hash from swf is: " + newHash);
				newExample(newHash);
				//trace ('Example URL Hash:' +  _example.urlHash);
			}
			
			private function graphHTML_completeHandler(event:Event):void
			{
				//			_htmlLoader = new HTMLLoader();
				//			_htmlLoader.
				//trace("graphBrowser_completeHandler");
				graphHTML.htmlLoader.window.updateHash = updateHash;
			}
			
			
			
			
			private function newExample(hash:String):void {
				if (!RxUtils.isEmpty(hash)) {
					var newExample:Example = RxUtils.clone(_example) as Example;
					newExample.hash = hash;
					
					newExample.userGenerated = true;
					newExample.name = "[New example]";
					invalidateDisplayList();
					example = newExample;
					trace("New example");
					trace(example.hash);
					//this.label = example.descShort;	
					//    			examplesList.selectedIndex = -1;
				}
			}
			
			private function destroyExample():void {
				_example.destroy({onSuccess: onExampleDestroy});
			}
			
			
			private function onExampleCreate(result:Example):void {
				_example = new Example;
			}
			
			
			private function onExampleDestroy(result:Example):void {
				//onExampleCreate(result);
			}
			
			
			
			protected function graphHTML_locationChangeHandler(event:Event):void
			{
				trace('Location: ' + event.currentTarget.location);
			}
			
			
			protected function graphHTML_clickHandler(event:MouseEvent):void
			{
				trace(event.currentTarget.toString());
			}
			
			[Bindable(event="exampleChange")]
			public function get example():Example
			{
				return _example;
			}
			
			
			public function set example(value:Example):void
			{
				_example = value;
				invalidateProperties();
				this.dispatchEvent(new Event("exampleChange"));
				this.dispatchEvent(new ExampleChangeEvent(example,true));
				this.graphHTML.location = 'app:/assets/graphs/' + example.graph.shortName + "/index.html#" + example.hash;

			}
			
			public function bookmarkExample(name:String):void {
				_example.name = name;
				if (_example.id) {
					_example.update();
				} else {
					_example.create();
				}
				
			}
		]]>
	</mx:Script>
	<mx:HTML id="graphHTML" htmlHost="{new TlzHost()}" location="" x="0" y="0"  width="100%" height="100%" borderColor="#FFFFFF" creationComplete="graphHTML_completeHandler(event)" locationChange="graphHTML_locationChangeHandler(event)"  click="graphHTML_clickHandler(event)" />
</mx:Canvas>


