<?xml version="1.0" encoding="utf-8"?>
<mx:VBox
	xmlns:s="library://ns.adobe.com/flex/spark" 
	xmlns:mx="http://www.adobe.com/2006/mxml"
	height="100%"
	width="100%"
	label=""
	>
	<mx:Metadata>
		[Event(name="exampleChanged", type="events.ExampleChangeEvent")]
	</mx:Metadata>
	<mx:Script>
		<![CDATA[
			import flash.events.Event;
			
			import gapdesktoprx.models.Example;
			import gapdesktoprx.overrides.TlzHost;
			
			import org.restfulx.utils.RxUtils;
			
			private var _htmlLoader:HTMLLoader;
			
			private var _example:Example = new Example();
			
			private var unsavedHash:String;
			
			private function updateHash(newHash:String):void {
				if (unsavedHash != newHash) {
					unsavedHash = newHash;
					this.label = "[New example]";
				}
			}
			
			private function graphHTML_completeHandler(event:Event):void
			{
				//			_htmlLoader = new HTMLLoader();
				//			_htmlLoader.
				trace("graphBrowser_completeHandler");
				var html:HTML = event.currentTarget as HTML;
				html.htmlLoader.window.updateHash = updateHash;
				html.location = _example.url();
				this.stage.focus = graphHTML.htmlLoader;
				//this.graphHTML.htmlLoader.window.setFocus();
			}
			
			
			
			
			private function saveNewExample(name:String, hash:String):void {
				if (!RxUtils.isEmpty(hash)) {
					var newExample:Example = new Example;
					newExample.hash = hash;
					newExample.graph = _example.graph;
					newExample.userGenerated = true;
					newExample.name = name;
					invalidateDisplayList();
					_example = newExample;
					_example.create();
					this.label = _example.name;
					trace("New example: " + example.hash);
				}
			}
			
			private function destroyExample():void {
				_example.destroy({onSuccess: onExampleDestroy});
			}
			
			
			private function onExampleCreate(result:Example):void {
				_example = new Example;
			}
			
			
			private function onExampleDestroy(result:Example):void {
				//onExampleCreate(result);
			}
			
			
			
			protected function graphHTML_locationChangeHandler(event:Event):void
			{
				
				trace('Location: ' + event.currentTarget.location);
			}
			
			public function get example():Example
			{
				return _example;
			}
			
			
			public function set example(value:Example):void
			{
				
				trace ('is the same: ' + (value.url()==_example.url()));					
				_example = value;
				this.label = example.name;
				//var urlReq:URLRequest = new URLRequest(example.url());
				if (graphHTML) {
					graphHTML.location = example.url();
				}
				//		graphHTML.htmlLoader.load(urlReq);
				invalidateProperties();
				
			}
			
			public function bookmarkExample(name:String):void {
				if (_example.hash == unsavedHash) {
					trace ('same hash as existing');
				} else {
					saveNewExample(name,unsavedHash);
				}
				
			}
			
		]]>
	</mx:Script>
	<!--<s:RichText fontSize="8" text="{graphHTML.location}" width="100%" height="10" />
	<s:RichText fontSize="8" text="{example.id}" height="10"/>
	-->	<mx:HTML id="graphHTML" htmlHost="{new TlzHost()}" location="" x="0" y="0"  width="100%" height="100%" borderColor="#FFFFFF" creationComplete="graphHTML_completeHandler(event)" locationChange="graphHTML_locationChangeHandler(event)"/>
</mx:VBox>


